<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projetos - Manager Maker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 40px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { background: white; padding: 30px 40px; border-radius: 15px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); }
        .header h1 { color: #5fb879; font-size: 32px; display: flex; align-items: center; gap: 15px; }
        .back-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 25px; border-radius: 8px; font-size: 16px; cursor: pointer; transition: all 0.3s ease; }
        .stats-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); transition: all 0.3s ease; }
        .stat-icon { font-size: 48px; margin-bottom: 15px; }
        .stat-title { font-size: 18px; color: #666; margin-bottom: 10px; }
        .stat-number { font-size: 36px; font-weight: bold; color: #333; }
        .stat-card.andamento { border-left: 5px solid #ffa726; }
        .stat-card.andamento .stat-number { color: #ffa726; }
        .stat-card.concluidos { border-left: 5px solid #5fb879; }
        .stat-card.concluidos .stat-number { color: #5fb879; }
        .stat-card.pontos { border-left: 5px solid #42a5f5; }
        .stat-card.pontos .stat-number { color: #42a5f5; }
        .content-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 25px; }
        .projects-section, .points-section { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); }
        .section-title { font-size: 24px; color: #333; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #e0e0e0; }
        .tabs { display: flex; gap: 15px; margin-bottom: 25px; }
        .tab { padding: 12px 25px; background: #f5f5f5; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; }
        .tab.active { background: linear-gradient(135deg, #5fb879 0%, #4a9d63 100%); color: white; }
        .project-list { display: flex; flex-direction: column; gap: 15px; }
        .project-card { padding: 20px; background: #f9f9f9; border-radius: 10px; border-left: 4px solid #5fb879; transition: all 0.3s ease; position: relative; }
        .project-card.andamento { border-left-color: #ffa726; }
        .project-name { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 8px; }
        .project-info { font-size: 14px; color: #666; display: flex; gap: 20px; margin-bottom: 10px; }
        .progress-bar { width: 100%; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #5fb879 0%, #4a9d63 100%); transition: width 0.3s ease; }
        .point-item { padding: 20px; background: linear-gradient(135deg, #42a5f5 0%, #1e88e5 100%); color: white; border-radius: 10px; margin-bottom: 15px; }
        .add-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #5fb879 0%, #4a9d63 100%); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 20px; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); }
        .modal-content { background: white; width: 90%; max-width: 400px; margin: 10% auto; padding: 30px; border-radius: 15px; }
        .modal-content input, .modal-content select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #ddd; }
        .modal-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .save-btn { flex: 1; padding: 12px; background: #5fb879; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .cancel-btn { flex: 1; padding: 12px; background: #ff5252; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-action { padding: 5px 10px; border-radius: 4px; border: none; color: white; cursor: pointer; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Gerenciamento de Projetos</h1>
            <button class="back-btn" onclick="window.location.href='/'">‚Üê Voltar</button>
        </div>

        <div class="stats-container">
            <div class="stat-card andamento"><div class="stat-icon">‚öôÔ∏è</div><div class="stat-title">Em Andamento</div><div class="stat-number">{{ stats.total_andamento }}</div></div>
            <div class="stat-card concluidos"><div class="stat-icon">‚úÖ</div><div class="stat-title">Conclu√≠dos</div><div class="stat-number">{{ stats.total_concluidos }}</div></div>
            <div class="stat-card pontos"><div class="stat-icon">üèÜ</div><div class="stat-title">Exposi√ß√µes</div><div class="stat-number">{{ stats.total_pontos }}</div></div>
        </div>

        <div class="content-grid">
            <div class="projects-section">
                <h2 class="section-title">Projetos</h2>
                <div class="tabs">
                    <button class="tab active" onclick="showTab('andamento')">Em Andamento</button>
                    <button class="tab" onclick="showTab('concluidos')">Conclu√≠dos</button>
                </div>

                <div id="andamento-list" class="project-list">
                    {% for projeto in projetos %}
                        {% if projeto.status == "andamento" %}
                        <div class="project-card andamento">
                            <div class="project-name">{{ projeto.nome }}</div>
                            <div class="project-info"><span>üìÖ {{ projeto.inicio }}</span><span>üë• {{ projeto.membros }} membros</span></div>
                            <div class="progress-bar"><div class="progress-fill" style="width: {{ projeto.progresso }}%"></div></div>
                            <div style="display: flex; gap: 8px; margin-top: 15px; justify-content: flex-end;">
                                <button class="btn-action" style="background: #42a5f5;" onclick="prepararEdicao('{{ projeto.id }}', '{{ projeto.nome }}', '{{ projeto.progresso }}', '{{ projeto.membros }}', '{{ projeto.inicio }}', '{{ projeto.status }}')">‚úèÔ∏è Editar</button>
                                <button class="btn-action" style="background: #ff5252;" onclick="deletarProjeto('{{ projeto.id }}')">üóëÔ∏è Excluir</button>
                            </div>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>

                <div id="concluidos-list" class="project-list" style="display: none;">
                    {% for projeto in projetos %}
                        {% if projeto.status == "concluido" %}
                        <div class="project-card">
                            <div class="project-name">{{ projeto.nome }}</div>
                            <div class="project-info"><span>üìÖ {{ projeto.inicio }}</span><span>üë• {{ projeto.membros }}</span></div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 100%"></div></div>
                            <div style="display: flex; gap: 8px; margin-top: 15px; justify-content: flex-end;">
                                <button class="btn-action" style="background: #42a5f5;" onclick="prepararEdicao('{{ projeto.id }}', '{{ projeto.nome }}', '100', '{{ projeto.membros }}', '{{ projeto.inicio }}', '{{ projeto.status }}')">‚úèÔ∏è Editar</button>
                                <button class="btn-action" style="background: #ff5252;" onclick="deletarProjeto('{{ projeto.id }}')">üóëÔ∏è Excluir</button>
                            </div>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
                <button class="add-btn" onclick="abrirModalCriacao()">+ Novo Projeto</button>
            </div>

            <div class="points-section">
                <h2 class="section-title">Pontos de Exposi√ß√£o</h2>
                {% for expo in exposicoes %}
                <div class="point-item" style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div class="point-name">üìç {{ expo.nome }}</div>
                        <div class="point-date" style="font-size: 0.8em; opacity: 0.8;">Data: {{ expo.data }}</div>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button onclick="prepararEdicaoExpo('{{ expo.id }}', '{{ expo.nome }}', '{{ expo.data }}')" 
                            style="background: rgba(255,255,255,0.2); border: none; color: white; cursor: pointer; padding: 5px; border-radius: 4px;">‚úèÔ∏è</button>
                        <button onclick="deletarExpo('{{ expo.id }}')" 
                            style="background: rgba(255,255,255,0.2); border: none; color: white; cursor: pointer; padding: 5px; border-radius: 4px;">üóëÔ∏è</button>
                    </div>
                </div>
                {% empty %}
                <p style="color: #666;">Nenhuma exposi√ß√£o cadastrada.</p>
                {% endfor %}
                <button class="add-btn" onclick="abrirModalExpoCriacao()">+ Adicionar Exposi√ß√£o</button>
            </div>
        </div>
    </div>

    <div id="modalProjeto" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">Novo Projeto</h3>
            <form id="formProjeto">
                <input type="text" id="nomeProj" placeholder="Nome" required>
                <input type="date" id="inicioProj" required>
                <input type="number" id="membrosProj" placeholder="Membros" required>
                <input type="number" id="progressoProj" placeholder="Progresso %" min="0" max="100" required>
                <select id="statusProj"><option value="andamento">Em Andamento</option><option value="concluido">Conclu√≠do</option></select>
                <div class="modal-buttons">
                    <button type="button" class="cancel-btn" onclick="fecharModal('modalProjeto')">Cancelar</button>
                    <button type="submit" class="save-btn">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modalExposicao" class="modal">
        <div class="modal-content">
            <h3 id="modalTitleExpo">Nova Exposi√ß√£o</h3>
            <form id="formExposicao">
                <input type="text" id="nomeExpo" placeholder="Nome do Evento" required>
                <input type="date" id="dataExpo" required>
                <div class="modal-buttons">
                    <button type="button" class="cancel-btn" onclick="fecharModal('modalExposicao')">Cancelar</button>
                    <button type="submit" class="save-btn">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function abrirModal(id) { document.getElementById(id).style.display = 'block'; }
        function fecharModal(id) { document.getElementById(id).style.display = 'none'; }
        
        // --- L√ìGICA PROJETOS ---
        function abrirModalCriacao() {
            document.getElementById('modalTitle').innerText = "Novo Projeto";
            document.getElementById('formProjeto').reset();
            configurarSubmitCriacao();
            abrirModal('modalProjeto');
        }

        async function deletarProjeto(id) {
            if (confirm('Deseja excluir este projeto?')) {
                const res = await fetch(`/gerenciar_projeto/${id}/`, { method: 'DELETE', headers: { 'X-CSRFToken': '{{ csrf_token }}' } });
                if (res.ok) location.reload();
            }
        }

        function prepararEdicao(id, nome, progresso, membros, inicio, status) {
            abrirModal('modalProjeto');
            document.getElementById('modalTitle').innerText = "Editar Projeto";
            document.getElementById('nomeProj').value = nome;
            document.getElementById('progressoProj').value = progresso;
            document.getElementById('membrosProj').value = membros;
            document.getElementById('inicioProj').value = inicio;
            document.getElementById('statusProj').value = status;

            document.getElementById('formProjeto').onsubmit = async (e) => {
                e.preventDefault();
                const dados = {
                    nome: document.getElementById('nomeProj').value,
                    progresso: document.getElementById('progressoProj').value,
                    membros: document.getElementById('membrosProj').value,
                    inicio: document.getElementById('inicioProj').value,
                    status: document.getElementById('statusProj').value
                };
                const res = await fetch(`/gerenciar_projeto/${id}/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}' },
                    body: JSON.stringify(dados)
                });
                if (res.ok) location.reload();
            };
        }

        function configurarSubmitCriacao() {
            document.getElementById('formProjeto').onsubmit = async (e) => {
                e.preventDefault();
                const dados = {
                    colecao: 'projetos',
                    nome: document.getElementById('nomeProj').value,
                    inicio: document.getElementById('inicioProj').value,
                    membros: document.getElementById('membrosProj').value,
                    progresso: document.getElementById('progressoProj').value,
                    status: document.getElementById('statusProj').value
                };
                const res = await fetch('/salvar_firebase/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}' },
                    body: JSON.stringify(dados)
                });
                if (res.ok) location.reload();
            };
        }

        // --- L√ìGICA EXPOSI√á√ïES ---
        function abrirModalExpoCriacao() {
            document.getElementById('modalTitleExpo').innerText = "Nova Exposi√ß√£o";
            document.getElementById('formExposicao').reset();
            configurarSubmitExpoCriacao();
            abrirModal('modalExposicao');
        }

        async function deletarExpo(id) {
            if (confirm('Deseja excluir esta exposi√ß√£o?')) {
                const res = await fetch(`/gerenciar_projeto/${id}/`, { method: 'DELETE', headers: { 'X-CSRFToken': '{{ csrf_token }}' } });
                if (res.ok) location.reload();
            }
        }

        function prepararEdicaoExpo(id, nome, data) {
            abrirModal('modalExposicao');
            document.getElementById('modalTitleExpo').innerText = "Editar Exposi√ß√£o";
            document.getElementById('nomeExpo').value = nome;
            document.getElementById('dataExpo').value = data;

            document.getElementById('formExposicao').onsubmit = async (e) => {
                e.preventDefault();
                const dados = {
                    nome: document.getElementById('nomeExpo').value,
                    data: document.getElementById('dataExpo').value
                };
                const res = await fetch(`/gerenciar_projeto/${id}/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}' },
                    body: JSON.stringify(dados)
                });
                if (res.ok) location.reload();
            };
        }

        function configurarSubmitExpoCriacao() {
            document.getElementById('formExposicao').onsubmit = async (e) => {
                e.preventDefault();
                const dados = { 
                    colecao: 'exposicoes', 
                    nome: document.getElementById('nomeExpo').value, 
                    data: document.getElementById('dataExpo').value 
                };
                const res = await fetch('/salvar_firebase/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}' },
                    body: JSON.stringify(dados)
                });
                if (res.ok) location.reload();
            };
        }

        function showTab(tab) {
            document.getElementById('andamento-list').style.display = tab === 'andamento' ? 'flex' : 'none';
            document.getElementById('concluidos-list').style.display = tab === 'concluidos' ? 'flex' : 'none';
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Inicializar submits padr√µes
        configurarSubmitCriacao();
        configurarSubmitExpoCriacao();
    </script>
</body>
</html>